<!doctype html>
<html lang="ru">
  <head>
   
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
     integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" 
     crossorigin="anonymous">

    <title>Личная страница пользователя</title>
    <style>
        .nav-pills .nav-link.active, .nav-pills .show>.nav-link {
            background-color: green;
        }
    </style>
  </head>
  <body>
  <div class="container mt-5">
    <div class="row">
        <div class="col-3">
          <div class="nav flex-column nav-pills" 
          id="v-pills-tab" role="tablist" 
          aria-orientation="vertical">
         
            <a class="nav-link " 
            id="profileTab" 
            data-toggle="pill"
            href="#v-pills-profile" 
            role="tab" 
            aria-controls="v-pills-profile" 
            aria-selected="false">Профиль</a>


            <a class="nav-link" 
            id="messagesTab" 
            data-toggle="pill" 
            href="#v-pills-messages" 
            role="tab" 
            aria-controls="v-pills-messages" 
            aria-selected="false">Сообщения</a>


            <a class="nav-link" 
            id="settingsTab" 
            data-toggle="pill" 
            href="#v-pills-settings" 
            role="tab" 
            aria-controls="v-pills-settings" 
            aria-selected="false">Настройки</a>
          </div>
        </div>
        <div class="col-9">
          <div class="tab-content" 
          id="v-pills-tabContent">
            
            <div 
            class="tab-pane fade " 
            id="v-pills-profile" 
            role="tabpanel" 
            aria-labelledby="v-pills-profile-tab">
            <section class="row">
                <div class="col-sm-4">
                    <img src="../../img/blog/author.png" alt="аватар" width="100%">
                </div>
                <div class="col-sm-8">
                    <h2>Id: <span id="userId"></span></h2>
                    <p>Имя и Фамилия: <span id="userName"></span></p>
                    <p>Email: <span id="userMail"></span></p>
                    <p>О себе: Lorem ipsum dolor sit amet consectetur adipisicing elit.
                        Assumenda illo harum illum itaque incidunt quasi aut rerum hic pariatur cum, 
                        enim consequatur cupiditate quo dolores ad laudantium minima! 
                        Recusandae, inventore!</p>
                </div>
            </section>
        </div>

            <div 
            class="tab-pane fade" 
            id="v-pills-messages" 
            role="tabpanel" 
            aria-labelledby="v-pills-messages-tab">
            <section class="row">
                <div class="col-md-6">
                    <div class="row border-bottom">
                        <div class="col-4"><img src="../../img/r2.jpg" alt=""></div>
                    <div class="col-8">
                        <h5>Семен Семеныч</h5>
                        <p>Завтра уеду за город, не смогу.</p>
                    </div>
                    </div>
                    <div class="row border-bottom">
                        <div class="col-4"><img src="../../img/r3.jpg" alt=""></div>
                    <div class="col-8">
                        <h5>Некто Ирина</h5>
                        <p>Жду завтра, как договорились в 15.00</p>
                    </div>
                    </div>
                    <div class="row border-bottom">
                        <div class="col-4"><img src="../../img/r8.jpg" alt=""></div>
                    <div class="col-8">
                        <h5>Паша Гараж</h5>
                        <p>Завтра на 15 у нас все в силе?</p>
                    </div>
                    </div>
                    <div class="row border-bottom">
                        <div class="col-4"><img src="../../img/r10.jpg" alt=""></div>
                    <div class="col-8">
                        <h5>Катерина</h5>
                        <p>Завтра на рыбалку мы едем?</p>
                    </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-10 ml-auto">
                            <textarea 
                            rows="4" 
                            placeholder="Текст сообщения"
                            class="form-control"
                            ></textarea>
                        </div>
                        <div class="col-10 ml-auto mt-2">
                            <input type="submit" value="Отправить сообщение" class="btn btn-success btn-block">
                        </div>
                    </div>
                </div>
            </section>
            <p class="py-5 display-4">Список друзей:</p>
            <section class="row">
                <table class="table table-striped">
                    <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">Фамилия Имя</th>
                        <th scope="col">Email</th>
                      </tr>
                    </thead>
                    <tbody id="userListTable"></tbody>

                    <tbody>
                     
                    </tbody>
                  </table>
            </section>
            </div>

            <div 
            class="tab-pane fade" 
            id="v-pills-settings" 
            role="tabpanel" 
            aria-labelledby="v-pills-settings-tab">
            <div class="row">
                <div class="col-5">
                    <div class="btn btn-info btn-block">Сделать красиво</div>
                    <div class="btn btn-info btn-block">Сделать еще лучше</div>
                </div>
            </div>
        </div>
          </div>
        </div>
      </div>
  </div>
  
    <script 
    src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" 
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" 
    crossorigin="anonymous"></script>
    <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" 
    crossorigin="anonymous"></script>

    <script>
        let pathname = location.pathname.split("/")[2];

        addEventListener("popstate", (event) => {
            let path = location.pathname.split("/")[2];
            if (path == "profile") {
            $('#profileTab').tab('show');
        } else if (path == "messages") {
            $('#messagesTab').tab('show');
        } else if (path == "settings") {
            $('#settingsTab').tab('show');
        }
        })
        
        async function getUser() {
            let response = await fetch("/getUser");
            return await response.json();
        }
        async function getUsers() {
            let response = await fetch("/getUsers");
            return await response.json();
        }
    
        if (pathname == "profile") {
          getUser().then((user) => {
            userId.innerText = `${user.id}`;
            userName.innerText = `${user.name} ${user.lastname}`;
            userMail.innerText = `${user.email}`;
            console.log(user);
          })
            $('#v-pills-profile').tab('show');
        } else if (pathname == "messages") {
            getUsers().then(
                (users) => {
                    for(let i=0; i < users.length; i++) {
                        userListTable.insertAdjacentHTML("beforeend", `
                        <tr>
                        <th scope="row">${users[i].id}</th>
                        <td>${users[i].lastname} ${users[i].name}</td>
                        <td>${users[i].email}</td>
                        </tr>
                        `);
                    }
                    console.log(users);
                }
            )
            $('#v-pills-messages').tab('show');
        } else if (pathname == "settings") {
            $('#v-pills-settings').tab('show');
        } else {
            location.href = location.protocol + "//" + location.host;
        }
        document.getElementById(pathname + "Tab").classList.add("active");

        let navLinks = document.querySelectorAll(".nav-link");

        for (let i = 0; i < navLinks.length; i++) {
            navLinks[i].addEventListener("click",() => {
                let page = navLinks[i].getAttribute("aria-controls").split("v-pills-")[1];
                console.log(page);
                history.pushState("", "", page);
            });
        }
      </script>

 
  </body>
</html>